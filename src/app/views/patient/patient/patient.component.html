<div class="row">
  <div class="col-md-12 p-0 mb-3">
    <p-breadcrumb [model]="items" [home]="home"></p-breadcrumb>
  </div>
</div>

<div class="row">
  <div class="col-md-12 p-0">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <p-card>
        <ng-template pTemplate="header">
          <div class="row pt-2">
            <div class="col-md-6">
              <h4>{{titlePage}}</h4>
            </div>
          </div>
        </ng-template>

        <div class="p-fluid row">
          <ng-container formGroupName="person">
          <div class="col-12 col-md-4">
            <label for="cpf">CPF</label>
            <input id="cpf" type="text" formControlName="cpf" mask="000.000.000-00" [ngClass]="applyInputError('person.cpf')" pInputText />
            <app-error-message [control]="form.get('person.cpf')" label="CPF"></app-error-message>
          </div>
          <div class="col-6 col-md-4">
            <label for="rg">RG</label>
            <input id="rg" type="text" formControlName="rg" [ngClass]="applyInputError('person.cpf')" pInputText />
            <app-error-message [control]="form.get('person.rg')" label="RG"></app-error-message>
          </div>
        </ng-container>
          <div class="col-6 col-md-4">
            <label for="sus_number">Cartão SUS</label>
            <input id="sus_number" type="text" formControlName="sus_number" pInputText />
          </div>
        </div>

        <div class="p-fluid row">
          <ng-container formGroupName="person">
            <div class="col-12 col-md-8">
              <label for="name">Nome</label>
              <input id="name" type="text" formControlName="name" [ngClass]="applyInputError('person.name')" pInputText />
              <app-error-message [control]="form.get('person.name')" label="Nome"></app-error-message>
            </div>
            <div class="col-6 col-md-4">
              <label for="sex">Sexo</label>
              <p-dropdown
                inputId="sex"
                placeholder="Selecionar..."
                optionLabel="label"
                [options]="sex"
                optionValue="id"
                formControlName="sex"
              ></p-dropdown>
            </div>
            <div class="col-6 col-md-4">
              <label for="birth_date">Data de nascimento</label>
              <input
                id="birth_date"
                type="date"
                formControlName="birth_date"  
                placeholder="Date"
                pInputText
              />
            </div>
            <div class="col-6 col-md-4">
              <label for="marital_status">Estado civil</label>
              <p-dropdown
                inputId="marital_status"
                placeholder="Selecionar..."
                optionLabel="label"
                [options]="marital_status"
                optionValue="id"
                formControlName="marital_status"
              ></p-dropdown>
            </div>
          </ng-container>
            <div class="col-12 col-md-4">
              <label for="health_insurance">Convênio</label>
              <p-dropdown
                inputId="health_insurance"
                placeholder="Selecionar..."
                optionLabel="name"
                [options]="healthInsurances"
                optionValue="id"
                formControlName="health_insurance_id"
                [filter]="true"
                filterBy="name"
                [virtualScroll]="true"
                [itemSize]="20"
                emptyFilterMessage="Não encontrado"
              ></p-dropdown>
            </div>
            <ng-container formGroupName="person">
            <div class="col-6 col-md-4">
              <label for="phone">Telefone</label>
              <input id="phone" type="text" formControlName="phone" [mask]="phoneMask" [ngClass]="applyInputError('person.phone')" pInputText />
              <app-error-message [control]="form.get('person.phone')" label="Telefone"></app-error-message>
            </div>
            <div class="col-6 col-md-4">
              <label for="phone_aux">Telefone auxiliar</label>
              <input
                id="phone_aux"
                type="text"
                formControlName="phone_aux"
                [mask]="phoneMaskAux"
                pInputText
              />
            </div>
          </ng-container>
          <div class="col-12 col-md-4">
            <label for="email">E-mail</label>
            <input id="email" type="text" formControlName="email" [ngClass]="applyInputError('email')" pInputText />
            <app-error-message [control]="form.get('email')" label="E-mail"></app-error-message>
          </div>
        </div>

        <div class="p-fluid row">
          <div class="col-12 col-md-12">
            <label for="note">Observações</label>
            <textarea
              id="note"
              type="text"
              rows="4"
              formControlName="note"
              pInputTextarea
            ></textarea>
          </div>
        </div>

        <div>
          <div class="row mt-3">
            <div class="col-md-12">
              <h5>Endereço</h5>
            </div>
          </div>
          
          <div class="p-fluid row" formGroupName="person">
            <div class="col-12 col-md-4">
              <label for="street">Rua</label>
              <input id="street" type="text" formControlName="street" pInputText />
            </div>
            <div class="col-12 col-md-4">
              <label for="district">Bairro</label>
              <input id="district" type="text" formControlName="district" pInputText />
            </div>
            <div class="col-12 col-md-4">
              <label for="address_number">Número</label>
              <input id="address_number" type="text" formControlName="address_number" pInputText />
            </div>

            <div class="col-12 col-md-4">
              <label for="state">Estado</label>
              <p-dropdown
                inputId="state"
                placeholder="Selecionar..."
                optionLabel="name"
                [options]="arrStates"
                optionValue="id"
                formControlName="state_id"
                [filter]="true"
                filterBy="name"
                [virtualScroll]="true"
                [itemSize]="20"
                emptyFilterMessage="Não encontrado"
              ></p-dropdown>
            </div>
            <div class="col-12 col-md-4">
              <label for="city">Cidade</label>
              <p-dropdown
                inputId="city"
                placeholder="Selecionar..."
                optionLabel="name"
                [options]="arrCities"
                optionValue="id"
                formControlName="city_id"
                [filter]="true"
                filterBy="name"
                [virtualScroll]="true"
                [itemSize]="20"
                emptyFilterMessage="Não encontrado"
              ></p-dropdown>
            </div>
            
            <div class="col-12 col-md-4">
              <label for="cep">CEP</label>
              <input id="cep" type="text" formControlName="cep" mask="00000-000" pInputText />
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-12 col-md-12 m-0 text-right">
            <button
              pButton
              type="submit"
              label="Salvar"
              icon="pi pi-check"
              class="p-button-success mr-2"
            ></button>
            <button
              pButton
              type="button"
              label="Cancelar"
              (click)="cancel()"
              icon="pi pi-times"
              class="p-button-secondary"
            ></button>
          </div>
        </div>
      </p-card>
    </form>
  </div>
</div>
